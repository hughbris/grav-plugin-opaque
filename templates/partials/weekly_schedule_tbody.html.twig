{% set schedules = openhrs.opening.schedulesWeek(date(), context) %}
{{ dump(schedules) }}
<tbody>
	{% import 'partials/current_status.html.twig' as transforms %}
	{% for schedule in schedules %}
		{% set title = NULL %}
		{% set classes = [] %}
		{% if schedule.day == date() %}
			{% set title = 'PLUGIN_OPAQUE.TODAY'|t|capitalize %}
			{% set classes = classes|merge( ['current'] ) %}
			{% set classes = classes|merge( [ (openhrs.opening.isOpen ? 'open' : 'closed') ] ) %}
			{% if 'closed' in classes %}
				{% set status = openhrs.opening.statusAt(date(), false) %}
				{% if status.open_on_day %}
					{% set classes = classes|merge( ['trading-day'] ) %}
				{% endif %}
			{% endif %}
		{% elseif schedule.day == 'now'|date_modify('-1 day') %}
			{% set title = 'PLUGIN_OPAQUE.YESTERDAY'|t|capitalize %}
		{% elseif schedule.day == 'now'|date_modify('+1 day') %}
			{% set title = 'PLUGIN_OPAQUE.TOMORROW'|t|capitalize %}
		{% elseif schedule.day == 'now'|date_modify('+2 day') %}
			{% set title = 'PLUGIN_OPAQUE.TOMORROW_PLUS_1'|t|capitalize %}
		{% endif %}
		{% set attr_title = ( title is null ? '' : ' title="' ~ title ~ '"' ) %}
		{% set attr_class = ( classes is empty ? '' : ' class="' ~ classes|join(' ')|trim ~ '"' ) %}
		{% set openings = ( schedule.schedule is empty ? 'Closed' : transforms.niceOpenings(openhrs.opening.formatSchedule(schedule.schedule, 'g.ia', ['.i'])) ) %}
		<tr{{ attr_title }}{{ attr_class }}>
			<th scope= "row">{{ schedule.day|date('F j') }}, <abbr title="{{ schedule.day|date('l') }}" class="day">{{ schedule.day|date('D') }}</abbr></th>  {# FIXME: those strings need internationalising #}
		<td>{{ openings }}</td>
	</tr>
	{% endfor %}
</tbody>
